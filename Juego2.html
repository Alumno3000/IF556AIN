<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Flappy Bird Simple</title>
  <style>
    /* Estilos básicos y variables de colores */
    :root {
      --bg: linear-gradient(#70c5ce, #ffffff); /* Fondo del cielo */
      --green: #60b13b; /* Color de los tubos */
      --dark: #4a752c; /* Color oscuro */
      --pipe: #7ecb5a; /* Color claro de los tubos */
      --pipe-dark: #3f6d22; /* Color oscuro de los tubos */
      --ui: rgba(0,0,0,.6); /* Color del UI */
    }

    html, body {
      height: 100%; /* Ocupa toda la altura */
      margin: 0; /* Eliminar márgenes */
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: var(--bg); /* Fondo del juego */
      display: grid;
      place-items: center; /* Centrar contenido */
    }

    .wrap {
      position: relative;
      width: 400px; /* Ancho del área de juego */
      max-width: 92vw; /* Ajuste para pantallas pequeñas */
      aspect-ratio: 2/3; /* Relación de aspecto 2:3 (400x600) */
    }

    canvas {
      width: 100%; /* El lienzo ocupa todo el ancho del contenedor */
      height: 100%; /* El lienzo ocupa toda la altura del contenedor */
      background: linear-gradient(#70c5ce, #bdefff 60%, #fff 100%); /* Fondo del lienzo (cielo) */
      border-radius: 16px; /* Bordes redondeados */
      box-shadow: 0 10px 30px rgba(0,0,0,.25); /* Sombra del lienzo */
      display: block;
    }

    /* Estilos para el HUD (interfaz de usuario) */
    .hud {
      position: absolute;
      inset: 0;
      pointer-events: none;
      display: grid;
      grid-template-rows: 1fr auto;
    }

    .score {
      text-align: center;
      margin-top: 12px;
      font-size: 32px;
      font-weight: 900;
      text-shadow: 0 2px 0 #fff, 0 4px 10px rgba(0,0,0,.25); /* Sombra del puntaje */
      color: #222;
      user-select: none;
    }

    .center-msg {
      display: grid;
      place-items: center;
      gap: 10px;
      padding-bottom: 16px;
    }

    .card {
      pointer-events: auto;
      background: rgba(255,255,255,.85);
      border-radius: 14px;
      padding: 12px 14px;
      box-shadow: 0 10px 25px rgba(0,0,0,.25); /* Sombra del mensaje */
      text-align: center;
      backdrop-filter: blur(6px); /* Efecto de desenfoque */
    }

    .title { font-size: 20px; font-weight: 800; }
    .small { font-size: 12px; opacity: .8; }
    
    button {
      pointer-events: auto;
      border: 0;
      background: #ffcc00;
      color: #222;
      padding: 10px 16px;
      border-radius: 999px; /* Bordes redondeados del botón */
      font-weight: 800;
      cursor: pointer;
      box-shadow: 0 6px 0 #d4a700;
      transform: translateY(0);
      transition: transform .05s ease, box-shadow .05s ease;
    }

    button:active { 
      transform: translateY(2px); 
      box-shadow: 0 4px 0 #d4a700; 
    }

    .hidden { display: none; }
  </style>
</head>
<body>
  <div class="wrap">
    <!-- Lienzo para el juego -->
    <canvas id="game" width="400" height="600" aria-label="Flappy Bird"></canvas>
    
    <!-- Interfaz de usuario (HUD) -->
    <div class="hud">
      <div class="score" id="score">0</div> <!-- Puntuación -->
      <div class="center-msg">
        <div class="card" id="msg">
          <div class="title" id="msg-title">Flappy Bird</div>
          <div class="small">Toca / clic o presiona ESPACIO para aletear</div>
          <div class="small">Evita los tubos y consigue puntos pasando por el hueco</div>
          <div style="margin-top:8px">
            <button id="btnStart">Jugar</button> <!-- Botón de inicio -->
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ====== Utilidades de Audio (WebAudio: sin archivos externos) ======
    const Audio = (() => {
      const ctx = new (window.AudioContext || window.webkitAudioContext)();  // Crear contexto de audio
      function env(ctx, duration=0.15){  // Función para crear un efecto de sonido con envolvimiento
        const gain = ctx.createGain();
        gain.gain.setValueAtTime(0, ctx.currentTime);
        gain.gain.linearRampToValueAtTime(0.8, ctx.currentTime + 0.01);
        gain.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + duration);
        return gain;
      }
      function tone(freq=440, duration=0.12, type='sine'){  // Función para generar un tono
        const osc = ctx.createOscillator();
        const g = env(ctx, duration);
        osc.type = type; osc.frequency.value = freq;
        osc.connect(g).connect(ctx.destination);
        osc.start(); osc.stop(ctx.currentTime + duration);
      }
      function blip(){ tone(520, 0.08, 'square'); }
      function point(){ tone(880, 0.10, 'triangle'); }
      function hit(){ tone(120, 0.22, 'sawtooth'); }
      function swoosh(){ tone(300, 0.08, 'sine'); setTimeout(()=>tone(240,0.08,'sine'),70); }
      function resume(){ if (ctx.state === 'suspended') ctx.resume(); }  // Reanudar contexto de audio en iOS
      return { blip, point, hit, swoosh, resume };
    })();

    // ====== Configuración del juego ======
    const canvas = document.getElementById('game');
    const c = canvas.getContext('2d');  // Contexto de dibujo 2D
    const W = canvas.width, H = canvas.height;  // Dimensiones del lienzo

    let state = 'menu'; // Estado del juego ('menu', 'play', 'dead')
    let bird, pipes, score, best = 0, lastSpawn = 0, speed = 2.4; // Variables del juego

    const G = 0.42;        // Gravedad
    const FLAP = -7.2;     // Impulso de aleteo
    const GAP = 140;       // Hueco entre tubos
    const SPAWN_MS = 1300; // Tiempo de aparición de nuevos tubos

    // Función para resetear el juego
    function reset(){
      bird = { x: 80, y: H*0.4, vy: 0, r: 12, rot: 0 };  // Posición y características del pájaro
      pipes = [];
      score = 0; lastSpawn = 0; speed = 2.4;
      document.getElementById('score').textContent = score;
    }

    // Función para generar un tubo
    function spawnPipe(){
      const margin = 60;
      const topH = Math.random() * (H - GAP - margin*2) + margin;
      const bottomY = topH + GAP;
      pipes.push({ x: W + 40, top: topH, bottom: bottomY, w: 60, passed:false });
    }

    // ====== Entrada del juego ======
    function flap(){
      if(state === 'menu'){ startGame(); return; }
      if(state === 'dead'){ startGame(); return; }
      bird.vy = FLAP; bird.rot = -0.4; Audio.blip(); // Efecto de aleteo
    }
    
    // Eventos de teclado y clic para aletear
    window.addEventListener('keydown', e => {
      if(e.code === 'Space' || e.code === 'ArrowUp'){ e.preventDefault(); flap(); }
      if(e.code === 'KeyP' && state === 'play'){ togglePause(); }
    });
    canvas.addEventListener('pointerdown', flap);  // Clic en el lienzo
    document.getElementById('btnStart').addEventListener('click', () => { flap(); });

    // Función para pausar el juego
    let last = 0, paused = false;
    function togglePause(){ paused = !paused; }

    // Bucle de actualización del juego
    function update(dt){
      // Generación de tubos
      lastSpawn += dt;
      if(lastSpawn > SPAWN_MS){ lastSpawn = 0; spawnPipe(); }

      // Física del pájaro
      bird.vy += G; bird.y += bird.vy;
      bird.rot = Math.min(1.0, bird.rot + 0.03);

      // Comprobación de colisiones con el suelo y el techo
      if(bird.y + bird.r > H - 20){ bird.y = H - 20 - bird.r; die(); }
      if(bird.y - bird.r < 0){ bird.y = bird.r; bird.vy = 0; }

      // Movimiento de los tubos
      for(const p of pipes){ p.x -= speed; }

      // Eliminar tubos fuera de la pantalla
      while(pipes.length && pipes[0].x + pipes[0].w < -20){ pipes.shift(); }

      // Lógica de puntuación y colisiones
      for(const p of pipes){
        if(!p.passed && p.x + p.w < bird.x){
          p.passed = true; score++; document.getElementById('score').textContent = score; Audio.point();
          if(score % 5 === 0) speed += 0.15; // Aumento de dificultad
        }
        // Comprobación de colisiones
        const inX = bird.x + bird.r > p.x && bird.x - bird.r < p.x + p.w;
        const hitTop = bird.y - bird.r < p.top;
        const hitBottom = bird.y + bird.r > p.bottom;
        if(inX && (hitTop || hitBottom)){ die(); }
      }
    }

    // Función para manejar la muerte del pájaro
    function die(){
      if(state !== 'play') return;
      state = 'dead';
      Audio.hit();
      best = Math.max(best, score);
      showMessage(`¡Fin del juego!`, `Puntaje: ${score} · Mejor: ${best}`, 'Reintentar');
    }

    // Función de renderizado del juego
    function draw(){
      // Fondo del cielo
      c.fillStyle = c.createLinearGradient(0, 0, 0, H);
      c.fillStyle.addColorStop(0, '#70c5ce');
      c.fillStyle.addColorStop(1, '#ffffff');
      c.fillRect(0, 0, W, H);

      // Suelo
      c.fillStyle = '#d0f4ff';
      c.fillRect(0, H - 20, W, 20);

      // Dibujo de los tubos
      for(const p of pipes){
        drawPipe(p.x, 0, p.w, p.top);
        drawPipe(p.x, p.bottom, p.w, H - p.bottom - 20);
      }

      // Dibujo del pájaro
      drawBird(bird.x, bird.y, bird.r, bird.rot);

      // Dibujo de las nubes
      drawClouds();
    }

    // Función para dibujar un tubo
    function drawPipe(x, y, w, h){
      c.fillStyle = '#7ecb5a';  // Color del tubo
      c.fillRect(x, y, w, h);
      c.fillStyle = '#6ab348';
      c.fillRect(x + 4, y + 4, w - 8, h - 8); // Borde del tubo
      c.strokeStyle = '#3f6d22'; c.lineWidth = 4;
      c.strokeRect(x + 1.5, y + 1.5, w - 3, h - 3); // Borde oscuro del tubo
      const lip = 10; 
      c.fillStyle = '#60b13b'; 
      c.fillRect(x - 4, y + h - lip, w + 8, lip); // Labio del tubo
    }

    // Función para dibujar el pájaro
    function drawBird(x, y, r, rot){
      c.save();
      c.translate(x, y); 
      c.rotate(rot);
      c.fillStyle = '#ffd166'; // Cuerpo del pájaro
      c.beginPath();
      c.arc(0, 0, r, 0, Math.PI * 2);
      c.fill();
      c.fillStyle = '#ffb703';  // Ala del pájaro
      c.beginPath();
      c.ellipse(-4, 0, r * 0.7, r * 0.45, 0, 0, Math.PI * 2);
      c.fill();
      c.fillStyle = '#fff';  // Ojo del pájaro
      c.beginPath();
      c.arc(5, -4, r * 0.35, 0, Math.PI * 2);
      c.fill();
      c.fillStyle = '#222'; 
      c.beginPath();
      c.arc(6, -4, r * 0.18, 0, Math.PI * 2); 
      c.fill();
      c.fillStyle = '#fb8500'; // Pico del pájaro
      c.beginPath();
      c.moveTo(r * 0.8, 0);
      c.lineTo(r * 1.5, 4);
      c.lineTo(r * 0.8, 8);
      c.closePath();
      c.fill();
      c.restore();
    }

    let cloudT = 0;
    // Función para dibujar las nubes
    function drawClouds(){
      cloudT += 0.003;
      const y1 = 80 + Math.sin(cloudT) * 6;
      const y2 = 150 + Math.cos(cloudT * 0.8) * 6;
      c.globalAlpha = 0.65; c.fillStyle = '#ffffff';
      blob(280 - (cloudT * 60) % 460, y1, 24);
      blob(120 - (cloudT * 40) % 460, y2, 18);
      c.globalAlpha = 1;
    }

    // Función para dibujar una nube en forma de "blob"
    function blob(x, y, r){
      c.beginPath();
      c.arc(x, y, r, 0, Math.PI * 2);
      c.arc(x + r * 0.8, y + 3, r * 0.75, 0, Math.PI * 2);
      c.arc(x - r * 0.8, y + 4, r * 0.6, 0, Math.PI * 2);
      c.fill();
    }

    // Bucle de animación del juego
    function loop(ts){
      const dt = Math.min(32, ts - last); last = ts;
      if(state === 'play' && !paused){ update(dt); }
      draw();
      requestAnimationFrame(loop);
    }

    // Función para mostrar mensajes en pantalla
    function showMessage(title, sub, btn){
      const card = document.getElementById('msg');
      document.getElementById('msg-title').textContent = title;
      card.querySelector('.small').textContent = sub || '';
      const b = document.getElementById('btnStart');
      b.textContent = btn || 'Jugar';
      card.classList.remove('hidden');
    }

    // Función para ocultar los mensajes
    function hideMessage(){
      document.getElementById('msg').classList.add('hidden');
    }

    // Función para iniciar el juego
    function startGame(){
      Audio.resume();
      reset(); hideMessage(); state = 'play'; Audio.swoosh();
    }

    // Iniciar el juego al cargar
    reset();
    requestAnimationFrame(loop);
  </script>
</body>
</html>